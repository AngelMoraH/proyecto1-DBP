{% extends './base.html' %}

{% block title %}Index{% endblock %}
{% block customCSS %}
<style>
    .container-movie {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        background-color: #f5f5f5;
        height: 7rem;
        width: 10rem;
        margin: 3rem;
        padding: 5px 0px;
    }
</style>
{% endblock %}

{% block body %}
<p>INDEX</p>
{{user}}
<hr>

<ul>
    <li>prueba</li>
</ul>
<div id="container-movies">

</div>
{% endblock %}

{% block customJS %}
<script>
    var likes;
    var userID = "{{user.id}}";
    console.log(userID);
    listMoviesUI = document.getElementById('container-movies');

    const showMovies = async () => {
        listMoviesUI.innerHTML = '';
        const response = await fetch('movies/')
        const movies = await response.json();
        movies.movies.forEach(movie => {
            listMoviesUI.innerHTML += `
            <div class="container-movie">
                <h3>${movie.data['nombre']}</h3>
                <p>${movie.data['anioEstreno']}</p>
                <p>${movie.data['director']}</p>
                <p>${movie.data['likes']}</p>
                <button onclick="validateLike(${movie.id},${userID})">Like</button>
            </div>
            `
        });
    }

    const addLikesMovies = async (id,idUser) => {
        const response = await fetch(`/likes/`, {
            method: 'POST',
            body: JSON.stringify({
                data: {
                    "idComment": id,
                    "idUsuario": idUser,
                    "dateCreated": "2022-04-11 11:11"
                }
            }),
            headers: {
                'Content-Type': 'application/json'
            }
        });
        const message = response.json();
        return message;
    }

    const removeLikeMovies = async (id,idUser) => {
        const response = await fetch(`/likes/${id}/${idUser}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        const message = response;
        return message;
    }
    const validateLike = async (id,idUser) => {
        var rMessage = await addLikesMovies(id,idUser);
        //console.log('response:',rMessage.message);
        if (rMessage.message == "like ya existe") {
            var reMessage= await removeLikeMovies(id,idUser);
            //console.log(reMessage);
        }
        showMovies();
    }



    document.addEventListener('DOMContentLoaded',showMovies);

    /*
    const button = document.getElementById('idButton');

    button.onclick = () => {
        const idMovie = document.getElementById('idMovie').innerHTML;
        likesMovies = document.getElementById('like').innerHTML;
        likesMovies = likesMovies.split(' ')
        validateLike(parseInt(idMovie,10), parseInt(likesMovies[1],10));
    }
    */


</script>
{% endblock %}


